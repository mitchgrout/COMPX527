function display(e,t){for(var a=document.getElementsByClassName("tabcontent"),i=document.getElementsByClassName("tablinks"),r="block"==$(t).style.display?"none":"block",n=0;n<a.length;n++)a[n].style.display="none";for(n=0;n<i.length;n++)i[n].className=i[n].className.replace(" active","");$(t).style.display=r,"block"==r?e.currentTarget.className+=" active":e.currentTarget.className.replace(" active","")}function attach_tree_listeners(){for(var e=document.getElementsByClassName("caret"),t=0;t<e.length;t++)e[t].onclick=function(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}}const DEFAULT_IMAGE_MODE="none",DEFAULT_IMAGE_TARGET="none",DEFAULT_IMAGE_WIDTH=0,DEFAULT_IMAGE_HEIGHT=0,DEFAULT_COCO_PAGE=0,DEFAULT_RESULTS="Response: none",DEFAULT_THRESHOLD=.5,NUM_COCO_IMAGES=25;var image_mode,image_target,image_width,image_height,coco_page,direct_file,direct_url,coco_url,image,ratio;function $(e){return document.getElementById(e)}function set_image_mode(e){return $("image_mode").innerHTML=image_mode=e}function set_image_target(e){return $("image_target").innerHTML=image_target=e}function set_image_width(e){return $("image_width").innerHTML=image_width=e}function set_image_height(e){return $("image_height").innerHTML=image_height=e}function set_coco_page(e){return $("current_page").innerHTML=coco_page=e}function set_thresh(e){return $("thresh").value=$("show_thresh").innerHTML=e}function reset(){attach_tree_listeners(),set_image_mode(DEFAULT_IMAGE_MODE),set_image_target(DEFAULT_IMAGE_TARGET),set_image_width(DEFAULT_IMAGE_WIDTH),set_image_height(DEFAULT_IMAGE_HEIGHT),$("results").innerHTML=DEFAULT_RESULTS,direct_file=void 0,direct_url=void 0,coco_url=void 0,image=void 0,ratio=void 0;var e=new Image;e.onload=function(){$("draw").width=e.width,$("draw").height=e.height,$("draw").getContext("2d").drawImage(e,0,0)},e.src="./placeholder.png",set_thresh(DEFAULT_THRESHOLD),$("file_in").value="",$("url_in").value="",set_coco_page(DEFAULT_COCO_PAGE),get_info(0)}function get_info(e){set_coco_page(Math.max(0,coco_page+e)),$("button_left").disabled=0==coco_page;for(var t=0;t<NUM_COCO_IMAGES;t++)$("img_"+t).name=$("img_"+t).src="";var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState){var e=JSON.parse(a.responseText);if(e.hasOwnProperty("success"))for(var t=0;t<Math.min(NUM_COCO_IMAGES,e.success.length);t++){var i=e.success[t],r=$("img_"+t);r.name=i.file_name+","+i.width+","+i.height,r.src=i.coco_url}else document.log("An error occured while fetching COCO images: "),document.log(e)}};var i=coco_page*NUM_COCO_IMAGES,r=(coco_page+1)*NUM_COCO_IMAGES;a.open("GET","http://"+SERVER_NAME+"/info.php?from="+i+"&to="+r,!0),a.send()}function set_image_info(e,t,a){const i=screen.height/2,r=screen.width/3;ratio=Math.min(i/e.height,r/e.width),image=e,set_image_mode(t),set_image_target(a),set_image_width(e.width),set_image_height(e.height),$("draw").width=e.width*ratio,$("draw").height=e.height*ratio,$("draw").getContext("2d").drawImage(e,0,0,$("draw").width,$("draw").height),$("results").innerHTML=DEFAULT_RESULTS}function load_local_image(){$("draw");var e=$("file_in").files[0],t=URL.createObjectURL(e),a=new Image;$("results").innerHTML=DEFAULT_RESULTS,a.onload=function(){set_image_info(a,"upload",e.name),direct_file=e},a.src=t}function load_direct_url(){var e=$("url_in").value,t=($("draw"),new Image);$("results").innerHTML=DEFAULT_RESULTS,t.onload=function(){set_image_info(t,"url",e),direct_url=e},t.src=e}function load_coco_image(e){var t=new Image;$("img_"+e).name.split(","),$("draw");t.onload=function(){set_image_info(t,"coco",t.src),coco_url=t.src},t.src=$("img_"+e).src}function detect(){var e=new FormData;switch(e.append("thresh",$("thresh").value),image_mode){case"upload":e.append("image",direct_file);break;case"url":e.append("url",direct_url);break;case"coco":e.append("url",coco_url);break;default:return}var t=new XMLHttpRequest,a=$("draw").getContext("2d"),i=$("results");t.onreadystatechange=function(){if(4==this.readyState){var e=JSON.parse(t.responseText);if(a.drawImage(image,0,0,image.width*ratio,image.height*ratio),e.hasOwnProperty("error"))i.innerHTML='<span class="caret">Response: error</span><ul class="nested"> <li>Message: '+e.error+" </li></ul>";else{var r='<span class="caret">Response: success ('+e.success.length+' detections)</span><ul class="nested">';a.beginPath(),a.scale(ratio,ratio);for(var n=0;n<e.success.length;n++){var s=e.success[n],o=s.label,c=s.score.toPrecision(4),l=Math.round(s.box[0]),_=Math.round(s.box[1]),d=Math.round(s.box[2]),g=Math.round(s.box[3]);a.lineWidth="1",a.strokeStyle="red",a.fillStyle="red",a.rect(l,_,d-l,g-_),a.fillRect(l,g,d-l,20),a.stroke(),a.fillStyle="white",a.font="15px Arial",a.fillText(o+": "+c,l,g+12),a.stroke(),r+='<li> <span class="caret">#'+(n+1)+'</span> <ul class="nested">  <li>Label: '+o+"</li>  <li>Score: "+c+'</li>  <li>   <span class="caret">Box</span>   <ul class="nested">    <li>x1: '+l+"</li>    <li>y1: "+_+"</li>    <li>x2: "+d+"</li>    <li>y2: "+g+"</li>   </ul>  </li> </ul></li>"}a.scale(1/ratio,1/ratio),r+="</ul>",i.innerHTML=r}attach_tree_listeners(),$("thresh").disabled=$("reset").disabled=$("detect").disabled=!1}},$("thresh").disabled=$("reset").disabled=$("detect").disabled=!0,t.open("POST","http://"+SERVER_NAME+"/detect.php",!0),t.send(e)}
